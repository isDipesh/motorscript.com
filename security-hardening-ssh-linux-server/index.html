<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Security: Hardening SSH on Linux Server - motorscript</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" name="author" content="Dipesh Acharya"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/b8a9e6d.js" as="script"><link rel="preload" href="/_nuxt/012922b.js" as="script"><link rel="preload" href="/_nuxt/9d30018.js" as="script"><link rel="preload" href="/_nuxt/db4041f.js" as="script"><link rel="preload" href="/_nuxt/eb4fa09.js" as="script"><style data-vue-ssr-id="5c670272:0 5c670272:1 3191d5ad:0">@import url(https://fonts.googleapis.com/css2?family=Zilla+Slab&display=swap);html{font-family:"Zilla Slab",serif;font-size:137.5%;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box;color:#3a4149}body{max-width:1280px;margin:0 auto;word-wrap:break-word}*,:after,:before{box-sizing:border-box}img{max-width:100%}main{padding:0 1rem}a{text-decoration:none;color:#215182}footer,header{font-size:16px}footer a,header a{color:inherit}header a{font-size:2em;font-weight:400;margin:.2em 0;display:block}header{border-bottom:1px solid #dbdfe1;padding:0 1rem}h1.title{margin-bottom:1rem;font-size:1.5em}h3{font-size:1.2em}h2,h3,h4{font-weight:400}h2,h3,h4{margin-bottom:.25em}h2{font-size:1.3em;font-weight:700}footer{margin-top:1rem;border-top:1px solid #dbdfe1;padding:1rem}footer div{padding:.25rem}.center{text-align:center}p{line-height:1.5rem;margin-top:0;margin-bottom:1rem}.time{font-size:.9rem;color:#777}.posts a{color:inherit}.posts li{padding:.25rem 0}.hl{background:#eee;overflow:auto;padding:0 .3rem;border-radius:5%;font-size:.85em}.content{margin-top:1rem;line-height:1.4rem}.t1{padding-top:1rem}.l1{padding-left:1rem}.small{font-size:65%}.right{float:right}.btn{background:#ccc;padding:.5rem;cursor:pointer;border-radius:5%;font-weight:300}.btn:hover{background:#bbb;box-shadow:0 0 0 #666;top:5px;left:5px}ul{margin-top:0}.block{background:#f9f9f9;border-left:10px solid #ccc;margin:1.5em 10px;padding:.5em 10px}.block ul{margin-top:.3rem;list-style:square outside none}.block ul li{padding:.2rem 0}input{outline:0;border:1px solid #ddd;color:inherit}input,input:focus{padding:3px 0 3px 3px}input:focus{box-shadow:0 0 5px #000;border:1px solid #000}pre.ascii{line-height:1rem}article{margin-bottom:2em}:not(pre)>code{padding:.3em;white-space:normal;background:#f5f2f0;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal}pre>code{font-family:monospace!important;display:block}code,pre{max-width:100%;overflow:auto}ol.pad li{padding:1em 0}.pl-1{padding-left:1em}.pl-2{padding-left:2em}.pt-1{padding-top:1em}.company{padding:1em;margin:1em;border:1px solid #ccc;display:flex}.company a{min-width:180px;display:flex;align-items:center;justify-content:center}.company img{height:30px;display:block}.company img.larger{height:40px}pre{line-height:1em!important}pre.normal{white-space:normal!important}pre.code-content,pre.code-content[class*=language-]{background:#ddd;margin-top:-1em;padding-left:2em}pre .command-line-prompt{border-right:none;margin-right:0}pre.code-content.mini{padding:0 0 0 1em}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}</style>
  </head>
  <body itemscope itemtype="https://schema.org/WebPage" data-n-head="%7B%22itemscope%22:%7B%22ssr%22:%22%22%7D,%22itemtype%22:%7B%22ssr%22:%22https://schema.org/WebPage%22%7D%7D">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><header><a href="/" class="nuxt-link-active">motorscript.com</a></header> <main itemscope itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><div><h1 itemprop="name headline" class="title">Security: Hardening SSH on Linux Server</h1> <div class="time">Published: <time itemprop="datePublished">22 Mar 2020</time></div> <!----> <!----></div> <div itemprop="articleBody" class="content">
      SSH is an essential tool to remotely administrate servers. Although SSH is
      a very secure protocol, you are prone to brute-force attacks if you don't
      follow proper security measures. The following instructions can be
      employed to improve security of a SSH installation on a server with
      default configuration. It is assumed that the default settings which are
      secure haven't been already modified.

      <p>Warning: Incorrect SSH settings may lock you out of the server.</p> <h2>Harden SSH Configuration</h2>

      Login to your server and start editing OpenSSH service
      configuration file:

      <pre data-prompt="#" class="language-bash command-line"><code>vi /etc/ssh/sshd_config</code></pre> <h3>Update the port for SSH service</h3> <pre data-prompt="$" class="language-bash command-line"><code>Port 23456</code></pre>
      Use a port number in the range 1024-49151. Although networking tools can
      easily detect open ports, this may prevent bots and humans only trying to
      penetrate on the default port - <i class="hl">22</i>.

      <h3>Use the following HostKey configuration</h3> <pre class="language-js"><code>HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key</code></pre> <h3>Change default Key Exchange algorithms and Ciphers</h3> <pre class="language-js"><code>KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128@openssh.com</code></pre>
      (Recommended by Mozilla)

      <h3>Enable Verbose Logging</h3> <pre class="language-js"><code>LogLevel VERBOSE</code></pre> <h3>Disable Remote Root Login</h3> <pre class="language-js"><code>PermitRootLogin no</code></pre> <h3>Only Allow Specific Users to SSH</h3> <pre class="language-js"><code>AllowUsers <i>username1</i> <i>username2</i></code></pre> <h3>Disable X11Forwarding</h3> <pre class="language-js"><code>X11Forwarding no</code></pre>
      Because you probably don't need GUIs on server.

      <h3>Automatically Disconnect Idle Sessions</h3> <pre class="language-js"><code>ClientAliveInterval 300
ClientAliveCountMax 0</code></pre>
      SSH sessions will disconnect when no data is received for 5 minutes.

      <h3>Disable Password Authentication</h3> <pre class="language-js"><code>PasswordAuthentication no</code></pre>
      This prevents brute-force login attacks. You will have to use key pair to
      authenticate.

      <p>Confirm if you can make new SSH connections to the server using the current configuration
      before exiting your current SSH session.</p> <p>
        For older versions of OpenSSH, please refer to this
        <a href="https://infosec.mozilla.org/guidelines/openssh" target="_blank" rel="noopener noreferrer">Mozilla Guideline.</a></p> <h2>Create an included SSH config file</h2>
       You can also create a separate <span class="hl">conf</span> file and include it in your base sshd configuration file <span class="hl">/etc/ssh/sshd_config</span>. Recent installations are already configured to include all configurations from the directory <span class="hl">/etc/ssh/sshd_config.d/</span>.
      <pre data-prompt="#" class="language-bash command-line"><code>vi /etc/ssh/sshd_config.d/add.conf</code></pre> <pre class="language-ini code-content"><code>#AllowUsers username1 username2
#Port 23456
PermitRootLogin no
X11Forwarding no

HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key

KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128@openssh.com

LogLevel VERBOSE

ClientAliveInterval 300
ClientAliveCountMax 0

PasswordAuthentication no</code></pre> <h2>Generate Private/Public Key Pair</h2>

      On your local computer, generate new SSH key pair. You may want to backup
      your existing key pairs or create the new pair in a different location.
      Use a passphrase you can retrieve later while adding this SSH key to your
      agent.
      <pre data-prompt="$" class="language-bash command-line"><code>ssh-keygen -t rsa</code></pre>

      Add the new SSH private key to your SSH agent.
      <pre data-prompt="$" class="language-bash command-line"><code>ssh-add ~/.ssh/id_rsa</code></pre>
      Use the path you generated the key pairs in.

      <p>Copy the contents of <i class="hl">id_rsa.pub</i>.</p> <p>On the server, paste it to <i class="hl">~/.ssh/authorized_keys</i></p>

      You should now be able to securely SSH into the server without using a
      password.

      <h2>Other Security Measures</h2> <h3>Only allow certain sets of IP to SSH</h3>
      Edit <span class="hl">hosts.allow</span> to add allow-list.
      <pre data-prompt="#" class="language-bash command-line"><code>vi /etc/hosts.allow</code></pre> <pre class="language-js code-content"><code>sshd: 192.168.1.5, 94.1.1.1/12, 10.65.140.23/32</code></pre>
      You can use single IP address or a range.

      <h3>Block certain IP or range of IPs</h3>
      If brute-force attacks are coming regularly from a certain IP or range,
      you can block all such incoming connections to your server.
      <p>Edit <span class="hl">hosts.deny</span> to add block-list.</p> <pre data-prompt="#" class="language-bash command-line"><code>vi /etc/hosts.deny</code></pre> <pre class="language-js code-content"><code>sshd: 192.168.1.5, 94.1.1.1/12, 10.65.140.23/32</code></pre> <h3>Login Banner</h3>
      A login banner can be used to warn intruders of legal consequences. It can
      also be used to remind legitimate users of their responsibilities and
      obligations.

      <p>For displaying a message after a user logs in:
      <pre data-prompt="#" class="language-bash command-line"><code>vi /etc/motd</code></pre></p> <h3>Firewall and other tools</h3>
      A firewall is also a good solution to filter connections for various
      protocols including SSH. Firewalls and services like <i class="hl">fail2ban</i> can be used to block illicit connections to the server.    
      <p><a href="/security-hardening-ubuntu-server/">Refer to this article to view futher tips to harden your server.</a></p></div></article> <div id="disqus_thread" itemscope itemtype="https://schema.org/UserComments"></div> <!----></main> <footer><div class="center">
    My Weblog of Cheat-sheets 
    [<a href="/about-me/">
        About Me
    </a>]
  </div> <div class="center">
    Powered by
    <a target="_blank" href="https://nuxtjs.org" rel="noreferrer noopener">Nuxt.js</a>
    | Hosted on
    <a target="_blank" href="https://github.com/xtranophilist/motorscript.com" rel="noreferrer noopener">Github</a>
    | Built using
    <a target="_blank" href="https://travis-ci.org" rel="noreferrer noopener">Travis CI</a></div></footer></div></div></div><script>window.__NUXT__=function(e){return{layout:"default",data:[{}],fetch:{},error:e,serverRendered:!0,routePath:"/security-hardening-ssh-linux-server",config:{app:{basePath:"/",assetsPath:"/_nuxt/",cdnURL:e}}}}(null)</script><script src="/_nuxt/b8a9e6d.js" defer></script><script src="/_nuxt/eb4fa09.js" defer></script><script src="/_nuxt/012922b.js" defer></script><script src="/_nuxt/9d30018.js" defer></script><script src="/_nuxt/db4041f.js" defer></script>
  </body>
</html>
